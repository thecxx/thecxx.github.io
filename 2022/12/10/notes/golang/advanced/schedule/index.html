<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="士不可以不弘毅，任重而道远。"><title>Golang深度解读：调度 | KAMI</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//fastly.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//fastly.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//fastly.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/prettify/prettify.css"><script type="text/javascript" src="//fastly.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//fastly.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//fastly.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//fastly.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Golang深度解读：调度</h1><a id="logo" href="/.">KAMI</a><p class="description">士不可以不弘毅，任重而道远。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/guestbook/"><i class="fa fa-book"> 留言</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Golang深度解读：调度</h1><div class="post-meta">Dec 10 2022<span> | </span><span class="category"><a href="/categories/笔记/">笔记</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.8k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 6</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#调度模型"><span class="toc-number">1.</span> <span class="toc-text">调度模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#调度流程"><span class="toc-number">1.1.</span> <span class="toc-text">调度流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简化模型"><span class="toc-number">1.2.</span> <span class="toc-text">简化模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#进入调度"><span class="toc-number">2.</span> <span class="toc-text">进入调度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查找可运行G"><span class="toc-number">3.</span> <span class="toc-text">查找可运行G</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#全局查找"><span class="toc-number">3.1.</span> <span class="toc-text">全局查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#窃取工作"><span class="toc-number">3.2.</span> <span class="toc-text">窃取工作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#选择目标P"><span class="toc-number">3.2.1.</span> <span class="toc-text">选择目标P</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#窃取半数G"><span class="toc-number">3.2.2.</span> <span class="toc-text">窃取半数G</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行可运行G"><span class="toc-number">4.</span> <span class="toc-text">执行可运行G</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#让渡执行权"><span class="toc-number">5.</span> <span class="toc-text">让渡执行权</span></a></li></ol></div></div><div class="post-content"><p>通过对M，P，G的简单介绍，我们大致上了解了这几种概念在Go语言运行机制中的基本作用</p>
<ul>
<li>M封装操作系统的线程，提供运行资源</li>
<li>P封装G运行过程中需要的辅助资源，并为G提供排队管理</li>
<li>G封装运行上下文，提供运行用户代码的能力</li>
</ul>
<p>三者协作，只要有源源不断可运行的G存在，M+P的组合就会不断地循环调度，直到没有可运行的G时，M与P解绑，并进入休眠状态。</p>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxODJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjUyNnB4O2hlaWdodDoxODJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1MjYgMTgyIiB3aWR0aD0iNTI2cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM1IiB4PSIxODguNSIgeT0iMjIuOTk1MSI+5pys5Zyw6Zif5YiX5LiO5YWo5bGA6Zif5YiXPC90ZXh0PjwhLS1lbnRpdHkgcC0tPjxnIGlkPSJlbGVtX3AiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjkiIHg9IjI5OSIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkiIHg9IjMwOSIgeT0iNjcuMjkyIj5QPC90ZXh0PjwvZz48IS0tZW50aXR5IG0tLT48ZyBpZD0iZWxlbV9tIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjMyIiB4PSIyOTcuNSIgeT0iMTQwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMiIgeD0iMzA3LjUiIHk9IjE2My4yOTIiPk08L3RleHQ+PC9nPjwhLS1lbnRpdHkgZzAtLT48ZyBpZD0iZWxlbV9nMCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIzOCIgeD0iMzY0LjUiIHk9IjE0MC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgiIHg9IjM3NC41IiB5PSIxNjMuMjkyIj5nMDwvdGV4dD48L2c+PCEtLWVudGl0eSBnMS0tPjxnIGlkPSJlbGVtX2cxIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI5IiB4PSIzNjMiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5IiB4PSIzNzMiIHk9IjY3LjI5MiI+ZzwvdGV4dD48L2c+PCEtLWVudGl0eSBnMi0tPjxnIGlkPSJlbGVtX2cyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI5IiB4PSI0MjciIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5IiB4PSI0MzciIHk9IjY3LjI5MiI+ZzwvdGV4dD48L2c+PCEtLWVudGl0eSBnMy0tPjxnIGlkPSJlbGVtX2czIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI5IiB4PSI0OTEiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5IiB4PSI1MDEiIHk9IjY3LjI5MiI+ZzwvdGV4dD48L2c+PCEtLWVudGl0eSBnbG9iLS0+PGcgaWQ9ImVsZW1fZ2xvYiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2NCIgeD0iMTk5LjUiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NCIgeD0iMjA5LjUiIHk9IjY3LjI5MiI+Z2xvYmFsPC90ZXh0PjwvZz48IS0tZW50aXR5IGc0LS0+PGcgaWQ9ImVsZW1fZzQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjkiIHg9IjEzNSIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkiIHg9IjE0NSIgeT0iNjcuMjkyIj5nPC90ZXh0PjwvZz48IS0tZW50aXR5IGc1LS0+PGcgaWQ9ImVsZW1fZzUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjkiIHg9IjcxIiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOSIgeD0iODEiIHk9IjY3LjI5MiI+ZzwvdGV4dD48L2c+PCEtLWVudGl0eSBnNi0tPjxnIGlkPSJlbGVtX2c2Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI5IiB4PSI3IiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOSIgeD0iMTciIHk9IjY3LjI5MiI+ZzwvdGV4dD48L2c+PCEtLWVudGl0eSBnNy0tPjxnIGlkPSJlbGVtX2c3Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI5IiB4PSI3IiB5PSIxNDAuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkiIHg9IjE3IiB5PSIxNjMuMjkyIj5nPC90ZXh0PjwvZz48IS0tZW50aXR5IGc4LS0+PGcgaWQ9ImVsZW1fZzgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjkiIHg9IjcxIiB5PSIxNDAuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkiIHg9IjgxIiB5PSIxNjMuMjkyIj5nPC90ZXh0PjwvZz48IS0tZW50aXR5IGc5LS0+PGcgaWQ9ImVsZW1fZzkiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjkiIHg9IjEzNSIgeT0iMTQwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5IiB4PSIxNDUiIHk9IjE2My4yOTIiPmc8L3RleHQ+PC9nPjwhLS1saW5rIHAgdG8gZzEtLT48ZyBpZD0ibGlua19wX2cxIj48cGF0aCBkPSJNMzI4LjI1LDYyLjI5NjkgQzMzOS43OTMsNjIuMjk2OSAzNTEuMzM2LDYyLjI5NjkgMzYyLjg3OSw2Mi4yOTY5ICIgZmlsbD0ibm9uZSIgaWQ9InAtZzEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Ny4wLDcuMDsiLz48L2c+PCEtLWxpbmsgZzEgdG8gZzItLT48ZyBpZD0ibGlua19nMV9nMiI+PHBhdGggZD0iTTM5Mi41LDYyLjI5NjkgQzQwMy45ODQsNjIuMjk2OSA0MTUuNDY5LDYyLjI5NjkgNDI2Ljk1Myw2Mi4yOTY5ICIgZmlsbD0ibm9uZSIgaWQ9ImcxLWcyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZzIgdG8gZzMtLT48ZyBpZD0ibGlua19nMl9nMyI+PHBhdGggZD0iTTQ1Niw2Mi4yOTY5IEM0NjcuNjAyLDYyLjI5NjkgNDc5LjIwMyw2Mi4yOTY5IDQ5MC44MDUsNjIuMjk2OSAiIGZpbGw9Im5vbmUiIGlkPSJnMi1nMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHAgdG8gbS0tPjxnIGlkPSJsaW5rX3BfbSI+PHBhdGggZD0iTTMxMy41LDgwLjUzNzkgQzMxMy41LDk3LjQ5ODYgMzEzLjUsMTIzLjI0MjQgMzEzLjUsMTQwLjE2NTIgIiBmaWxsPSJub25lIiBpZD0icC1tIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgbSB0byBnMC0tPjxnIGlkPSJsaW5rX21fZzAiPjxwYXRoIGQ9Ik0zMjkuNjMzLDE1OC4yOTY5IEMzNDEuMTM2LDE1OC4yOTY5IDM1Mi42MzksMTU4LjI5NjkgMzY0LjE0MSwxNTguMjk2OSAiIGZpbGw9Im5vbmUiIGlkPSJtLWcwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjcuMCw3LjA7Ii8+PC9nPjwhLS1saW5rIGc0IHRvIGdsb2ItLT48ZyBpZD0ibGlua19nNF9nbG9iIj48cGF0aCBkPSJNMTY0LjIzNCw2Mi4yOTY5IEMxNzUuOTcxLDYyLjI5NjkgMTg3LjcwNyw2Mi4yOTY5IDE5OS40NDQsNjIuMjk2OSAiIGZpbGw9Im5vbmUiIGlkPSJnNC1nbG9iIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjcuMCw3LjA7Ii8+PC9nPjwhLS1saW5rIGc1IHRvIGc0LS0+PGcgaWQ9ImxpbmtfZzVfZzQiPjxwYXRoIGQ9Ik0xMDAsNjIuMjk2OSBDMTExLjYwMiw2Mi4yOTY5IDEyMy4yMDMsNjIuMjk2OSAxMzQuODA1LDYyLjI5NjkgIiBmaWxsPSJub25lIiBpZD0iZzUtZzQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBnNiB0byBnNS0tPjxnIGlkPSJsaW5rX2c2X2c1Ij48cGF0aCBkPSJNMzYuNSw2Mi4yOTY5IEM0Ny45ODQ0LDYyLjI5NjkgNTkuNDY4OCw2Mi4yOTY5IDcwLjk1MzEsNjIuMjk2OSAiIGZpbGw9Im5vbmUiIGlkPSJnNi1nNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGc2IHRvIGc3LS0+PGcgaWQ9ImxpbmtfZzZfZzciPjxwYXRoIGQ9Ik0yMS41LDgwLjUzNzkgQzIxLjUsOTcuNDk4NiAyMS41LDEyMy4yNDI0IDIxLjUsMTQwLjE2NTIgIiBmaWxsPSJub25lIiBpZD0iZzYtZzciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBnNyB0byBnOC0tPjxnIGlkPSJsaW5rX2c3X2c4Ij48cGF0aCBkPSJNMzYuNSwxNTguMjk2OSBDNDcuOTg0NCwxNTguMjk2OSA1OS40Njg4LDE1OC4yOTY5IDcwLjk1MzEsMTU4LjI5NjkgIiBmaWxsPSJub25lIiBpZD0iZzctZzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBnOCB0byBnOS0tPjxnIGlkPSJsaW5rX2c4X2c5Ij48cGF0aCBkPSJNMTAwLDE1OC4yOTY5IEMxMTEuNjAyLDE1OC4yOTY5IDEyMy4yMDMsMTU4LjI5NjkgMTM0LjgwNSwxNTguMjk2OSAiIGZpbGw9Im5vbmUiIGlkPSJnOC1nOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1TUkM9W1JUMngyaThtNTBSV19KbjV3NXhmX1Y4R1dnekdqSHVCd09LUVM3S0hkNW5yQUJXd0VFWmMwbmQxanAxZlFURDJqbG5WSld4eWdUQ0xJbWdhQUo0TTFhYnNmODlRcVJvYlY0bmVqT1JNMTNrcERVUGVwOEs5cWRBUHFFdjY3M05wZGlQeVpHS1EycEtNUUltNk8xY0p5NnFVbDdkLWhaVC1rZHBVUHR3eXl6VVhZbVAwSE1QY2RVNk1jUjhsc2NIODNnMlphWWo3cE5NdkJxcG5XVmRlYkdLV1VtZ1h3S1EyMS1ZSEZsWTBfWDAybUExVjhmZldnRlA3Vzk1QXlIeTBdLS0+PC9nPjwvc3ZnPg==">
<a id="more"></a>
<h2 id="调度模型"><a href="#调度模型" class="headerlink" title="调度模型"></a>调度模型</h2><h3 id="调度流程"><a href="#调度流程" class="headerlink" title="调度流程"></a>调度流程</h3><p>每一个Worker M在工作时，都会进入到如下的调度流程中</p>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0OTBweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjg1MHB4O2hlaWdodDo0OTBweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA4NTAgNDkwIiB3aWR0aD0iODUwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIwIiB4PSIzNTguMjUiIHk9IjIyLjk5NTEiPueyvueugOeJiOiwg+W6pua1geeoi+WbvjwvdGV4dD48IS0tZW50aXR5IG1zdGFydC0tPjxnIGlkPSJlbGVtX21zdGFydCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzEiIHg9IjciIHk9IjI1NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExIiB4PSIxNyIgeT0iMjc3LjI5MiI+cnVudGltZS5tc3RhcnQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbXN0YXJ0MC0tPjxnIGlkPSJlbGVtX21zdGFydDAiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwIiB4PSIxNzMuNSIgeT0iMjU0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAiIHg9IjE4My41IiB5PSIyNzcuMjkyIj5ydW50aW1lLm1zdGFydDA8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbXN0YXJ0MS0tPjxnIGlkPSJlbGVtX21zdGFydDEiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwIiB4PSIzNDguNSIgeT0iMjU0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAiIHg9IjM1OC41IiB5PSIyNzcuMjkyIj5ydW50aW1lLm1zdGFydDE8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc2NoZWR1bGUtLT48ZyBpZD0iZWxlbV9zY2hlZHVsZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDUiIHg9IjUyNCIgeT0iMjU0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUiIHg9IjUzNCIgeT0iMjc3LjI5MiI+cnVudGltZS5zY2hlZHVsZTwvdGV4dD48L2c+PCEtLWVudGl0eSBzdG9wbS0tPjxnIGlkPSJlbGVtX3N0b3BtIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOSIgeD0iNTMyIiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5IiB4PSI1NDIiIHk9IjY3LjI5MiI+cnVudGltZS5zdG9wbTwvdGV4dD48L2c+PCEtLWVudGl0eSBmaW5kcnVubmFibGUtLT48ZyBpZD0iZWxlbV9maW5kcnVubmFibGUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTc3IiB4PSI1MDgiIHk9IjE0MS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU3IiB4PSI1MTgiIHk9IjE2NC4yOTIiPnJ1bnRpbWUuZmluZFJ1bm5hYmxlPC90ZXh0PjwvZz48IS0tZW50aXR5IGV4ZWN1dGUtLT48ZyBpZD0iZWxlbV9leGVjdXRlIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MCIgeD0iNzA0LjUiIHk9IjI1NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIwIiB4PSI3MTQuNSIgeT0iMjc3LjI5MiI+cnVudGltZS5leGVjdXRlPC90ZXh0PjwvZz48IS0tZW50aXR5IGdvZ28tLT48ZyBpZD0iZWxlbV9nb2dvIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExOCIgeD0iNzEzLjUiIHk9IjM1MS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTgiIHg9IjcyMy41IiB5PSIzNzQuMjkyIj5ydW50aW1lLmdvZ288L3RleHQ+PC9nPjwhLS1lbnRpdHkgbG9naWNhbC0tPjxnIGlkPSJlbGVtX2xvZ2ljYWwiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMyIiB4PSI3MDYuNSIgeT0iNDQ4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIiIHg9IjcxNi41IiB5PSI0NzEuMjkyIj7nlKjmiLfku6PnoIHpgLvovpHpg6jliIY8L3RleHQ+PC9nPjwhLS1lbnRpdHkgR29zY2hlZC0tPjxnIGlkPSJlbGVtX0dvc2NoZWQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ0IiB4PSI1MjcuNSIgeT0iNDQ4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjQiIHg9IjUzNy41IiB5PSI0NzEuMjkyIj5ydW50aW1lLkdvc2NoZWQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbWNhbGwtLT48ZyBpZD0iZWxlbV9tY2FsbCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjAiIHg9IjUzOS41IiB5PSIzNTEuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMCIgeD0iNTQ5LjUiIHk9IjM3NC4yOTIiPnJ1bnRpbWUubWNhbGw8L3RleHQ+PC9nPjwhLS1saW5rIG1zdGFydCB0byBtc3RhcnQwLS0+PGcgaWQ9ImxpbmtfbXN0YXJ0X21zdGFydDAiPjxwYXRoIGQ9Ik0xMzguMjk1LDI3Mi4yOTY5IEMxNDguMjEsMjcyLjI5NjkgMTU4LjEyNiwyNzIuMjk2OSAxNjguMDQxLDI3Mi4yOTY5ICIgZmlsbD0ibm9uZSIgaWQ9Im1zdGFydC10by1tc3RhcnQwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3My4yMjYsMjcyLjI5NjksMTY0LjIyNiwyNjguMjk2OSwxNjguMjI2LDI3Mi4yOTY5LDE2NC4yMjYsMjc2LjI5NjksMTczLjIyNiwyNzIuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIG1zdGFydDAgdG8gbXN0YXJ0MS0tPjxnIGlkPSJsaW5rX21zdGFydDBfbXN0YXJ0MSI+PHBhdGggZD0iTTMxMy41NjgsMjcyLjI5NjkgQzMyMy40NTgsMjcyLjI5NjkgMzMzLjM0OCwyNzIuMjk2OSAzNDMuMjM3LDI3Mi4yOTY5ICIgZmlsbD0ibm9uZSIgaWQ9Im1zdGFydDAtdG8tbXN0YXJ0MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNDguNDA5LDI3Mi4yOTY5LDMzOS40MDksMjY4LjI5NjksMzQzLjQwOSwyNzIuMjk2OSwzMzkuNDA5LDI3Ni4yOTY5LDM0OC40MDksMjcyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBtc3RhcnQxIHRvIHNjaGVkdWxlLS0+PGcgaWQ9ImxpbmtfbXN0YXJ0MV9zY2hlZHVsZSI+PHBhdGggZD0iTTQ4OC43MjcsMjcyLjI5NjkgQzQ5OC42NDUsMjcyLjI5NjkgNTA4LjU2NCwyNzIuMjk2OSA1MTguNDgyLDI3Mi4yOTY5ICIgZmlsbD0ibm9uZSIgaWQ9Im1zdGFydDEtdG8tc2NoZWR1bGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTIzLjY2OSwyNzIuMjk2OSw1MTQuNjY5LDI2OC4yOTY5LDUxOC42NjksMjcyLjI5NjksNTE0LjY2OSwyNzYuMjk2OSw1MjMuNjY5LDI3Mi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZmluZHJ1bm5hYmxlIHRvIHNjaGVkdWxlLS0+PGcgaWQ9ImxpbmtfZmluZHJ1bm5hYmxlX3NjaGVkdWxlIj48cGF0aCBkPSJNNTk2LjUsMTgyLjc2OTkgQzU5Ni41LDIwMi4wMzE5IDU5Ni41LDIyOS42MzY5IDU5Ni41LDI0OC44ODE5ICIgZmlsbD0ibm9uZSIgaWQ9ImZpbmRydW5uYWJsZS1zY2hlZHVsZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1OTYuNSwxNzcuNjQwOSw1OTIuNSwxODYuNjQwOSw1OTYuNSwxODIuNjQwOSw2MDAuNSwxODYuNjQwOSw1OTYuNSwxNzcuNjQwOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1OTYuNSwyNTQuMDc0OSw2MDAuNSwyNDUuMDc0OSw1OTYuNSwyNDkuMDc0OSw1OTIuNSwyNDUuMDc0OSw1OTYuNSwyNTQuMDc0OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMiIHg9IjU5Ny41IiB5PSIyMjAuMzYzOCI+5p+l5om+5Y+v6L+Q6KGMZzwvdGV4dD48L2c+PCEtLWxpbmsgc3RvcG0gdG8gZmluZHJ1bm5hYmxlLS0+PGcgaWQ9Imxpbmtfc3RvcG1fZmluZHJ1bm5hYmxlIj48cGF0aCBkPSJNNTk2LjUsODUuNzYxOSBDNTk2LjUsMTAwLjgxMzkgNTk2LjUsMTIwLjU2MTkgNTk2LjUsMTM1LjY1MTkgIiBmaWxsPSJub25lIiBpZD0ic3RvcG0tZmluZHJ1bm5hYmxlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU5Ni41LDgwLjcyMDksNTkyLjUsODkuNzIwOSw1OTYuNSw4NS43MjA5LDYwMC41LDg5LjcyMDksNTk2LjUsODAuNzIwOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1OTYuNSwxNDAuOTgyOSw2MDAuNSwxMzEuOTgyOSw1OTYuNSwxMzUuOTgyOSw1OTIuNSwxMzEuOTgyOSw1OTYuNSwxNDAuOTgyOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHNjaGVkdWxlIHRvIGV4ZWN1dGUtLT48ZyBpZD0ibGlua19zY2hlZHVsZV9leGVjdXRlIj48cGF0aCBkPSJNNjY5LjE2LDI3Mi4yOTY5IEM2NzkuMDg4LDI3Mi4yOTY5IDY4OS4wMTYsMjcyLjI5NjkgNjk4Ljk0NSwyNzIuMjk2OSAiIGZpbGw9Im5vbmUiIGlkPSJzY2hlZHVsZS10by1leGVjdXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjcwNC4xMzYsMjcyLjI5NjksNjk1LjEzNiwyNjguMjk2OSw2OTkuMTM2LDI3Mi4yOTY5LDY5NS4xMzYsMjc2LjI5NjksNzA0LjEzNiwyNzIuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGV4ZWN1dGUgdG8gZ29nby0tPjxnIGlkPSJsaW5rX2V4ZWN1dGVfZ29nbyI+PHBhdGggZD0iTTc3NC4xMzMsMjkwLjcyMDkgQzc3My44MDYsMzA2LjI1NTkgNzczLjMyNiwzMjkuMDc5OSA3NzIuOTcsMzQ1Ljk1MTkgIiBmaWxsPSJub25lIiBpZD0iZXhlY3V0ZS10by1nb2dvIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc3Mi44NjUsMzUwLjk4MjksNzc3LjA1NDQsMzQyLjA2OTUsNzcyLjk3MDcsMzQ1Ljk4NCw3NjkuMDU2MiwzNDEuOTAwMyw3NzIuODY1LDM1MC45ODI5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZ29nbyB0byBsb2dpY2FsLS0+PGcgaWQ9ImxpbmtfZ29nb19sb2dpY2FsIj48cGF0aCBkPSJNNzcyLjUsMzg3LjcyMTQgQzc3Mi41LDQwMy4yNTU0IDc3Mi41LDQyNi4wNzk4IDc3Mi41LDQ0Mi45NTIzICIgZmlsbD0ibm9uZSIgaWQ9ImdvZ28tdG8tbG9naWNhbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3NzIuNSw0NDcuOTgyOSw3NzYuNSw0MzguOTgyOSw3NzIuNSw0NDIuOTgyOSw3NjguNSw0MzguOTgyOSw3NzIuNSw0NDcuOTgyOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgR29zY2hlZCB0byBsb2dpY2FsLS0+PGcgaWQ9ImxpbmtfR29zY2hlZF9sb2dpY2FsIj48cGF0aCBkPSJNNjc2Ljk0Niw0NjYuMjk2OSBDNjg2Ljc3MSw0NjYuMjk2OSA2OTYuNTk2LDQ2Ni4yOTY5IDcwNi40MjEsNDY2LjI5NjkgIiBmaWxsPSJub25lIiBpZD0iR29zY2hlZC1iYWNrdG8tbG9naWNhbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NzEuODA5LDQ2Ni4yOTY5LDY4MC44MDksNDcwLjI5NjksNjc2LjgwOSw0NjYuMjk2OSw2ODAuODA5LDQ2Mi4yOTY5LDY3MS44MDksNDY2LjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIG1jYWxsIHRvIEdvc2NoZWQtLT48ZyBpZD0ibGlua19tY2FsbF9Hb3NjaGVkIj48cGF0aCBkPSJNNTk5LjUsMzkyLjc2MTcgQzU5OS41LDQwOS42NjI0IDU5OS41LDQzMi40ODM1IDU5OS41LDQ0Ny45ODI5ICIgZmlsbD0ibm9uZSIgaWQ9Im1jYWxsLWJhY2t0by1Hb3NjaGVkIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU5OS41LDM4Ny43MjE0LDU5NS41LDM5Ni43MjE0LDU5OS41LDM5Mi43MjE0LDYwMy41LDM5Ni43MjE0LDU5OS41LDM4Ny43MjE0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLXJldmVyc2UgbGluayBzY2hlZHVsZSB0byBtY2FsbC0tPjxnIGlkPSJsaW5rX3NjaGVkdWxlX21jYWxsIj48cGF0aCBkPSJNNTk3LjIwOSwyOTUuNzYxOSBDNTk3Ljc0MywzMTIuNjYxOSA1OTguNDY0LDMzNS40ODM5IDU5OC45NTMsMzUwLjk4MjkgIiBmaWxsPSJub25lIiBpZD0ic2NoZWR1bGUtYmFja3RvLW1jYWxsIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU5Ny4wNSwyOTAuNzIwOSw1OTMuMzM0OSwyOTkuODQyMiw1OTcuMjA3MiwyOTUuNzE4NCw2MDEuMzMwOSwyOTkuNTkwNyw1OTcuMDUsMjkwLjcyMDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tU1JDPVtUUDdCSWlHbTU4UnRVT2VtLXlmcUEtQk1sTXpHc3FvY2EyUDNjazhpUG5ZRzNXZWdrN0VYOGFmTkFlODgzaklOaVBUdjJ2alJ3SzBjWXZwSl9EeXZJVl8zS0lXMllXYzI4dnZINElWZTg0YjVtQ0s4MVlkS0FVM3hlRjYwNmtfN18wN2NreDBxZEE4ZThxWG56aUM5MlpQQkQyS3A1cEE5UU5JUUtIZ1NjTnhvVzlpM0xtNlFlcDBKY1pNdjJ5Q0NDeU44UDBXcVRxTVRWX3pqZGZsN3ZOUW5RU2xSeFFnZXlXaTU0dVJaQzIya1hZVENfUWQySkV3cWkyaWRzYTJQMEkxWWVReHpCOWt0SFJGRXN1ekx6VkRRVm9zUnVoQXdCcVMwUUFVWE1Yd0Z5TEh1bl9zS0o3STlsWDd6TlI0Vlk0c2FVa0hiaXF3M0VfT1VtbGhYZkx3TnJWTHgtdGxKRmJyWEM5SGphUHhUaTVqX2JuczBZVmVYNEprZGRRUUNibmlxb21oTVAxRXJIajE0RGhKRWNnV3J5dEhqZ0Rmakh3Rk9qX3EzXS0tPjwvZz48L3N2Zz4=">
<p>以<code>runtime.schedule()</code>函数为核心的调度逻辑，通过<code>runtime.findRunnable()</code>函数查找可运行的G，再进入到一套标准的用户代码执行逻辑中，直到让出执行权(图以执行<code>runtime.Gosched()</code>函数让出执行权举例)。<br>如果调度流程在执行<code>runtime.findRunnable()</code>函数过程中，没有查找到可运行的G，则调用<code>runtime.stopm()</code>函数，将当前M挂起，进入到休眠状态，直到再次被唤醒时，返回到<code>runtime.findRunnable()</code>函数中继续查找可运行的G，并再次回到调度流程。</p>
<h3 id="简化模型"><a href="#简化模型" class="headerlink" title="简化模型"></a>简化模型</h3><p>对调度流程的进一步简化，可将调度的状态切换理解成如下模型：</p>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI4NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MjQ0cHg7aGVpZ2h0Ojg2cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQ0IDg2IiB3aWR0aD0iMjQ0cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTAiIHg9IjcwLjI1IiB5PSIyMi45OTUxIj7osIPluqbnirbmgIHliIfmjaI8L3RleHQ+PCEtLWVudGl0eSBmaW5kLS0+PGcgaWQ9ImVsZW1fZmluZCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0OCIgeD0iMTAxLjUiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOCIgeD0iMTExLjUiIHk9IjY3LjI5MiI+ZmluZDwvdGV4dD48L2c+PCEtLWVudGl0eSBleGVjLS0+PGcgaWQ9ImVsZW1fZXhlYyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NCIgeD0iMTg0LjUiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNCIgeD0iMTk0LjUiIHk9IjY3LjI5MiI+ZXhlYzwvdGV4dD48L2c+PCEtLWVudGl0eSBzbGVlcC0tPjxnIGlkPSJlbGVtX3NsZWVwIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU5IiB4PSI3IiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzkiIHg9IjE3IiB5PSI2Ny4yOTIiPnNsZWVwPC90ZXh0PjwvZz48IS0tbGluayBmaW5kIHRvIGV4ZWMtLT48ZyBpZD0ibGlua19maW5kX2V4ZWMiPjxwYXRoIGQ9Ik0xNDkuNjg4LDczLjIxMjkgQzE1OS41NTcsNzUuOTI0MSAxNjkuNDI2LDc2LjUwMTggMTc5LjI5Niw3NC45NDU5ICIgZmlsbD0ibm9uZSIgaWQ9ImZpbmQtdG8tZXhlYyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxODQuNDU3LDczLjkzNzgsMTc0Ljg1NzEsNzEuNzM3NCwxNzkuNTQ5Nyw3NC44OTY0LDE3Ni4zOTA4LDc5LjU4OSwxODQuNDU3LDczLjkzNzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIGZpbmQgdG8gZXhlYy0tPjxnIGlkPSJsaW5rX2ZpbmRfZXhlYyI+PHBhdGggZD0iTTE1NC41NzcsNTAuMjEyMyBDMTY0LjUzNyw0OC4xODczIDE3NC40OTcsNDguMzM1MiAxODQuNDU3LDUwLjY1NiAiIGZpbGw9Im5vbmUiIGlkPSJmaW5kLWJhY2t0by1leGVjIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0OS42ODgsNTEuMzgwOSwxNTkuMzcxLDUzLjE4MDksMTU0LjU1MTIsNTAuMjE5NCwxNTcuNTEyNyw0NS4zOTk3LDE0OS42ODgsNTEuMzgwOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgc2xlZXAgdG8gZmluZC0tPjxnIGlkPSJsaW5rX3NsZWVwX2ZpbmQiPjxwYXRoIGQ9Ik03MS4wMTQ2LDc1LjExNzEgQzgxLjEyNiw3Ni40OTM4IDkxLjIzNzQsNzUuNzc5NCAxMDEuMzQ4OCw3Mi45NzQgIiBmaWxsPSJub25lIiBpZD0ic2xlZXAtYmFja3RvLWZpbmQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjYuMDUwOCw3NC4yNzMzLDc0LjI1MzEsNzkuNzI1Miw3MC45ODAxLDc1LjExMTMsNzUuNTkzOSw3MS44MzgzLDY2LjA1MDgsNzQuMjczMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHNsZWVwIHRvIGZpbmQtLT48ZyBpZD0ibGlua19zbGVlcF9maW5kIj48cGF0aCBkPSJNNjYuMDUwOCw1MC4zMjA0IEM3Ni4xNjIyLDQ4LjI1OTUgODYuMjczNiw0OC4yODk1IDk2LjM4NSw1MC40MTA1ICIgZmlsbD0ibm9uZSIgaWQ9InNsZWVwLXRvLWZpbmQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTAxLjM0ODgsNTEuNjE5OCw5My41NTEzLDQ1LjYwMzIsOTYuNDkwOSw1MC40MzYzLDkxLjY1NzgsNTMuMzc1OSwxMDEuMzQ4OCw1MS42MTk4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLVNSQz1bQXFmREJhZENJeXo5TEwxQW95bkJLTDk4QjVPMENSWUE0MUFmNVFkOU8wYUcwcmNZRTJTcmpHMGkwc1BuU1BMYWJlMzROc25lVmhmaHNWRWtSU3lRNmZ6c2ozX2hOUUo0bkdLb0xLNnRBM0N6ZXFKTjNjOEtZNTNHcEtiRDB1YzBST01nV1dmMUowTUoyOXFXNUcwMF0tLT48L2c+PC9zdmc+">
<p>当有可运行的G存在时，调度模型始终在find与exec之间循环切换，直到无可运行G时，进入sleep状态，直到被唤醒。</p>
<h2 id="进入调度"><a href="#进入调度" class="headerlink" title="进入调度"></a>进入调度</h2><p>无论是进程启动执行(主线程执行)，还是执行过程中创建新的Worker M，执行流程最终都会进入到<code>runtime.mstart()</code>函数中，并按循序执行<code>runtime.mstart()</code> -&gt; <code>runtime.mstart0()</code> -&gt; <code>runtime.mstart1()</code>，最终进入到调度流程中。</p>
<h2 id="查找可运行G"><a href="#查找可运行G" class="headerlink" title="查找可运行G"></a>查找可运行G</h2><p><strong>每一个可运行的G都是一个待执行的任务</strong>。<br>函数<code>runtime.schedule()</code>作为调度流程的核心，主要负责执行<strong>查找任务</strong>和<strong>执行任务</strong>，其中查找任务的逻辑由<code>runtime.findRunnable()</code>函数来负责完成。<br>忽略与查找可运行G目标不相关的逻辑，可以将查找流程总结为如下几个步骤：</p>
<ol>
<li>第一次从全局队列中查找可运行G(每执行61次G，则从全局队列中获取一次)</li>
<li>从本地队列中查找可运行G</li>
<li>第二次从全局队列中查找可运行G</li>
<li>从netpoll中查找可运行G</li>
<li>从其他P中窃取可运行G</li>
</ol>
<p>以上几个步骤都执行完，依然没有查找到可运行的G时，则会进入无事可做的状态，代码里也是这么注释的！<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// We have nothing <span class="keyword">to</span> <span class="keyword">do</span>.</span><br></pre></td></tr></table></figure></p>
<p>在这种状态下，当前执行的Worker M会与P解绑，并进入休眠状态，但再此之前，还会进行一些其他工作，如：GC扫描。<br>在查找可运行G的流程中，简单说下1和4两个步骤。</p>
<p><strong>周期性从全局队列中获取G</strong>：根据注释与代码逻辑，这么做的主要目的是为了保证调度的公平性，假如本地队列一直有可运行的G存在，全局队列的G就会长期得不到运行机会。<br><strong>netpoll的G</strong>：当代码中存在网络访问时，负责连接读写的Goroutine就绪时，会被调度，这里后续章节再进一步分析。</p>
<p>最后的最后，调度流程就会将P解绑，并通过调用<code>runtime.stopm()</code>函数将M挂起，进入休眠状态。</p>
<h3 id="全局查找"><a href="#全局查找" class="headerlink" title="全局查找"></a>全局查找</h3><p>从全局队列中查找可运行的G，使用的是<code>runtime.globrunqget()</code>函数，因为是操作全局队列，所以调用该函数前，需要对<code>sched.lock</code>全局变量字段加锁。<br>该函数主要用于从全局队列中获取可运行G，根据实际情况，假如获取的数量是1，则直接返回获取到的G；假如获取的数量大于1，则返回其中一个G，并将其他获取到的G保存到本地队列。</p>
<p>函数原型：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">globrunqget</span><span class="params">(_p_ *p, <span class="built_in">max</span> int32)</span></span> *g</span><br></pre></td></tr></table></figure></p>
<p><code>max</code>参数用来限制从全局队列获取可运行G的数量。</p>
<p><strong>备注：第一次和第二次从全局队列中查找可运行的G最大的区别在于，第一次获取时<code>max</code>参数设置的是1，第二次设置的是0，所以第一次最多只会从全局队列中获取1个可运行G，并不会从全局队列中转移可运行的G到本地队列</strong></p>
<p>接下来，再看看这个函数的具体处理步骤：</p>
<p><strong>第一步</strong>：使用全局队列的长度 / P的最大数量 = 得到每一个P的平均负载值<code>n</code></p>
<p>这一步主要计算一个公平的，每一个P除了本地队列中的G之外，全局队列中自己还有多少G需要处理。</p>
<p><strong>第二步</strong>：计算出负载值<code>n</code>后，再计算本地队列的最大长度除以2，用来限制<code>n</code>的最大值<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> n &gt; <span class="keyword">int32</span>(<span class="built_in">len</span>(_p_.runq))/<span class="number">2</span> &#123;</span><br><span class="line">    n = <span class="keyword">int32</span>(<span class="built_in">len</span>(_p_.runq)) / <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>P中<code>runq</code>字段的结构定义如下，因此<code>n</code>的最大长度为128。<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> p struct &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">	// <span class="type">Queue</span> of runnable goroutines. <span class="type">Accessed</span> without lock.</span><br><span class="line">	runqhead uint32</span><br><span class="line">	runqtail uint32</span><br><span class="line">	runq     [256]guintptr</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>第三步</strong>：获取一个可运行的G作为返回值，并将<code>n</code>-1个可运行的G保存至本地队列P中</p>
<h3 id="窃取工作"><a href="#窃取工作" class="headerlink" title="窃取工作"></a>窃取工作</h3><p>当调度流程从哪里都找不到可运行的G时，作为专业打工人，会自觉地尝试从其他的P那找点可运行的G过来。<br>窃取可运行G的主要工作由<code>runtime.stealWork()</code>函数来负责，但这个函数的主要逻辑是在选择目标P，并在确认目标后，交给<code>runtime.runqsteal()</code>函数来完成实际的可运行G的转移。</p>
<h4 id="选择目标P"><a href="#选择目标P" class="headerlink" title="选择目标P"></a>选择目标P</h4><p>先来看看<code>runtime.stealWork()</code>函数是怎么选择目标P的吧。</p>
<ol>
<li>先是选择策略，这里采用的是<strong>随机起始位置，非连续性遍历所有P</strong>的方案，非连续性即为遍历完下标<code>i</code>之后，下一个遍历的下标并不是<code>i</code>+1，而是伪随机的其他位置，直到所有的P都遍历一次</li>
<li>再是重试机制，在选择策略之外包含一层循环逻辑，循环次数为固定值4，即重试4次</li>
</ol>
<h4 id="窃取半数G"><a href="#窃取半数G" class="headerlink" title="窃取半数G"></a>窃取半数G</h4><p>当确定了目标P之后，就会调用<code>runtime.runqsteal()</code>函数来进行实际的转移操作，该函数的内部还会调用另一个<code>runtime.runqgrab()</code>函数来实现半数转移，即<strong>将目标P一半的可运行G转移给当前P</strong>。</p>
<h2 id="执行可运行G"><a href="#执行可运行G" class="headerlink" title="执行可运行G"></a>执行可运行G</h2><p>现在调度流程中已经存在一个可运行的G了，接下来就需要调用<code>runtime.execute()</code>函数来执行它。<br>这段过程主要对G做一些字段更新，比如：将状态由<code>_Grunnable</code>切换成<code>_Grunning</code>，将G与M绑定等等，最后交给<code>runtime.gogo()</code>函数处理。</p>
<h2 id="让渡执行权"><a href="#让渡执行权" class="headerlink" title="让渡执行权"></a>让渡执行权</h2><p>当运行中的G因为各种原因，交出运行资源后，调度流程便会再次回到<code>runtime.schedule()</code>函数进入下一轮循环。</p>
</div><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://oldchan.net/2022/12/10/notes/golang/advanced/schedule/" data-id="clcyms1ot0034rsu34im1jyhy" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLUlEQVR42u3aS1LDMBAFQO5/6bBlEcx7I4cqS61VCkyk9mLQfL6+4vX6sa6f+e35/PP1LksLAwPjsYzX5bre4LcDJbvk4OuzYWBgnMNIAmhOSo6e73V9NgwMDIyW1IbOfF8MDAyM2dfddflLnsTAwMBIktjkapgcKw/EH8nFMTAwHsjIq+7///kj/Q0MDIxHMV7lWi/Dtc2D6FQYGBhbM9YT1HZgYpigJsMfGBgYWzOSBmQ7/vW5kF3cYTEwMDZitAWslbLXdZBtr5Vv/m9gYGBsx2gbAHc1JvNgOgy1GBgYWzPa1LRtRuZDFcMxCwwMjK0Z1weale9nZbU8WGNgYJzAWGkMzDa7t/15Q38DAwPjIYw8+N6VRba/zX+OgYGxH6NNMtcT0WjAK/7bOopjYGA8kLEeLvOi273DFhgYGOcwVhoDs3fWluSi78fAwDiAkW+cf3V7BUyeLOqFGBgYGzFmpbH8qte2FobDFhgYGEcyVka72mGLtqhXBFwMDIyNGCul+Vlxf1bIi+65GBgYWzOS4Bu1EvMyWTmKEQVcDAyMAxjtBlFKWTZE25eCgYGxN+NVrlljIK+MDYt6GBgYWzPaMNeOf80uf+sXRwwMjP0Y7chpHl5Xxr/qqycGBsYBjDa5bS+Os9c0zMUxMDCOZ7RXullgrakYGBgYy2WvPN1NXtCbJzEwMA5gJFe3TzQ784bEH4OtGBgYWzNmqWNCzdsMbQK81N/AwMB4EuMbtWJVg72PRqEAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/golang/"><i class="fa fa-tag"></i>golang</a></div><div class="post-nav"><a class="pre" href="/2023/01/15/notes/golang/advanced/boot/">Golang深度解读：启动</a><a class="next" href="/2022/08/15/notes/golang/advanced/p/">Golang深度解读：P</a></div><div id="tcomment"></div><script src="https://fastly.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({
  envId: 'thecxx-1gxw7szk895715fd',
  el: '#tcomment',
  region: 'ap-shanghai',
  path: ''
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/容器/">容器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/笔记/">笔记</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统/">系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/长话/">长话</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/中间件/" style="font-size: 15px;">中间件</a> <a href="/tags/思考/" style="font-size: 15px;">思考</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/元宇宙/" style="font-size: 15px;">元宇宙</a> <a href="/tags/cpu/" style="font-size: 15px;">cpu</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/容器化/" style="font-size: 15px;">容器化</a> <a href="/tags/go/" style="font-size: 15px;">go</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/注入/" style="font-size: 15px;">注入</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/01/15/notes/golang/advanced/boot/">Golang深度解读：启动</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/12/10/notes/golang/advanced/schedule/">Golang深度解读：调度</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/15/notes/golang/advanced/p/">Golang深度解读：P</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/24/notes/golang/advanced/m/">Golang深度解读：M</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/10/notes/golang/advanced/g0/">Golang深度解读：g0</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/10/notes/golang/advanced/list/">Golang深度解读</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/06/15/opinion/give_up_the_php/">6年前，决定不再继续精进PHP</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/05/05/opinion/good_product/">好的产品?</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/11/17/opinion/internet_and_metaverse/">互联网络与元宇宙</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/18/arch/microservice/service/">微服务</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">KAMI.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//fastly.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//fastly.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/prettify.js?v=1.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/codeblock-render.js?v=1.0.0"></script></div></body></html>