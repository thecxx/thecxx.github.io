<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="士不可以不弘毅，任重而道远。"><title>Golang深度解读：M | KAMI</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//fastly.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//fastly.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//fastly.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/prettify/prettify.css"><script type="text/javascript" src="//fastly.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//fastly.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//fastly.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//fastly.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Golang深度解读：M</h1><a id="logo" href="/.">KAMI</a><p class="description">士不可以不弘毅，任重而道远。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/guestbook/"><i class="fa fa-book"> 留言</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Golang深度解读：M</h1><div class="post-meta">Jul 24 2022<span> | </span><span class="category"><a href="/categories/笔记/">笔记</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.2k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 4</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#worker-m"><span class="toc-number">1.</span> <span class="toc-text">worker m</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#m0"><span class="toc-number">1.1.</span> <span class="toc-text">m0</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sysmon"><span class="toc-number">2.</span> <span class="toc-text">sysmon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#template-thread"><span class="toc-number">3.</span> <span class="toc-text">template thread</span></a></li></ol></div></div><div class="post-content"><p>Go语言将线程抽象成M(Machine)，每个M都是可以独立运行的单元，M的数据结构中主要包含的是跟系统环境相关的字段。</p>
<p>Go语言将可执行的上下文保存在G(Goroutine)中，G的数据结构中主要包含跟执行环境相关的字段，包括寄存器值，栈地址、defer，panic的指针等等。</p>
<p>在<a href="/2022/07/10/notes/golang/advanced/g0/">《Golang深度解读：g0》</a>中，简单讲述了g0的基本信息和在调度中所负责的工作。最先了解g0，主要原因是g0才是真正意义上在线程上运行的逻辑，M在创建之后，系统环境相关的数据保存在M中，线程的执行数据保存在g0中，g0与普通用户协程共用相同的数据结构和计算逻辑，只是在内核调度过程中，需要区分g0与用户协程的部分边界。</p>
<a id="more"></a>
<h2 id="worker-m"><a href="#worker-m" class="headerlink" title="worker m"></a>worker m</h2><p>Go语言程序在执行过程中会创建多个M，但并不跟P的数量完全匹配，跟P绑定使用的M一般视为Worker Thread(为了统一概念，后面统一称Worker M)，即用户计算逻辑能使用到的线程，P数量的设置也直接影响用户协程的并行执行能力，关于P数量的设置可参考<code>runtime.GOMAXPROCS()</code>。</p>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxODJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjY1MHB4O2hlaWdodDoxODJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA2NTAgMTgyIiB3aWR0aD0iNjUwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjExIiB4PSIyMTIuNzUiIHk9IjIyLjk5NTEiPueyvueugOeJiFdvcmtlciBN5bi46KeE5Yib5bu65rWB56iLPC90ZXh0PjwhLS1lbnRpdHkgd2FrZXAtLT48ZyBpZD0iZWxlbV93YWtlcCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkiIHg9IjciIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkiIHg9IjE3IiB5PSI2Ny4yOTIiPnJ1bnRpbWUud2FrZXA8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc3RhcnRtLS0+PGcgaWQ9ImVsZW1fc3RhcnRtIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMSIgeD0iMTcxIiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExIiB4PSIxODEiIHk9IjY3LjI5MiI+cnVudGltZS5zdGFydG08L3RleHQ+PC9nPjwhLS1lbnRpdHkgbmV3bS0tPjxnIGlkPSJlbGVtX25ld20iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI1IiB4PSIzMzciIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDUiIHg9IjM0NyIgeT0iNjcuMjkyIj5ydW50aW1lLm5ld208L3RleHQ+PC9nPjwhLS1lbnRpdHkgbmV3bTEtLT48ZyBpZD0iZWxlbV9uZXdtMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzQiIHg9IjQ5Ny41IiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0IiB4PSI1MDcuNSIgeT0iNjcuMjkyIj5ydW50aW1lLm5ld20xPC90ZXh0PjwvZz48IS0tZW50aXR5IG5ld29zcHJvYy0tPjxnIGlkPSJlbGVtX25ld29zcHJvYyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjAiIHg9IjQ4NC41IiB5PSIxNDAuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MCIgeD0iNDk0LjUiIHk9IjE2My4yOTIiPnJ1bnRpbWUubmV3b3Nwcm9jPC90ZXh0PjwvZz48IS0tZW50aXR5IHB0aHJlYWRfY3JlYXRlLS0+PGcgaWQ9ImVsZW1fcHRocmVhZF9jcmVhdGUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMyIiB4PSIzMTcuNSIgeT0iMTQwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIiIHg9IjMyNy41IiB5PSIxNjMuMjkyIj5wdGhyZWFkX2NyZWF0ZTwvdGV4dD48L2c+PCEtLWVudGl0eSBtc3RhcnQtLT48ZyBpZD0iZWxlbV9tc3RhcnQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMxIiB4PSIxNTEiIHk9IjE0MC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExIiB4PSIxNjEiIHk9IjE2My4yOTIiPnJ1bnRpbWUubXN0YXJ0PC90ZXh0PjwvZz48IS0tbGluayB3YWtlcCB0byBzdGFydG0tLT48ZyBpZD0ibGlua193YWtlcF9zdGFydG0iPjxwYXRoIGQ9Ik0xMzYuMjc1LDYyLjI5NjkgQzE0Ni4wNTUsNjIuMjk2OSAxNTUuODM0LDYyLjI5NjkgMTY1LjYxNCw2Mi4yOTY5ICIgZmlsbD0ibm9uZSIgaWQ9Indha2VwLXRvLXN0YXJ0bSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNzAuNzI4LDYyLjI5NjksMTYxLjcyOCw1OC4yOTY5LDE2NS43MjgsNjIuMjk2OSwxNjEuNzI4LDY2LjI5NjksMTcwLjcyOCw2Mi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgc3RhcnRtIHRvIG5ld20tLT48ZyBpZD0ibGlua19zdGFydG1fbmV3bSI+PHBhdGggZD0iTTMwMi4wODIsNjIuMjk2OSBDMzExLjkxMiw2Mi4yOTY5IDMyMS43NDEsNjIuMjk2OSAzMzEuNTcxLDYyLjI5NjkgIiBmaWxsPSJub25lIiBpZD0ic3RhcnRtLXRvLW5ld20iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzM2LjcxMSw2Mi4yOTY5LDMyNy43MTEsNTguMjk2OSwzMzEuNzExLDYyLjI5NjksMzI3LjcxMSw2Ni4yOTY5LDMzNi43MTEsNjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIG5ld20gdG8gbmV3bTEtLT48ZyBpZD0ibGlua19uZXdtX25ld20xIj48cGF0aCBkPSJNNDYyLjAyLDYyLjI5NjkgQzQ3Mi4wMTksNjIuMjk2OSA0ODIuMDE5LDYyLjI5NjkgNDkyLjAxOCw2Mi4yOTY5ICIgZmlsbD0ibm9uZSIgaWQ9Im5ld20tdG8tbmV3bTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDk3LjI0Nyw2Mi4yOTY5LDQ4OC4yNDcsNTguMjk2OSw0OTIuMjQ3LDYyLjI5NjksNDg4LjI0Nyw2Ni4yOTY5LDQ5Ny4yNDcsNjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIG5ld20xIHRvIG5ld29zcHJvYy0tPjxnIGlkPSJsaW5rX25ld20xX25ld29zcHJvYyI+PHBhdGggZD0iTTU2NC41LDgwLjUzNzkgQzU2NC41LDk1Ljc3NiA1NjQuNSwxMTguMTAzOCA1NjQuNSwxMzQuNzU0NSAiIGZpbGw9Im5vbmUiIGlkPSJuZXdtMS10by1uZXdvc3Byb2MiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTY0LjUsMTQwLjE2NTIsNTY4LjUsMTMxLjE2NTIsNTY0LjUsMTM1LjE2NTIsNTYwLjUsMTMxLjE2NTIsNTY0LjUsMTQwLjE2NTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIHB0aHJlYWRfY3JlYXRlIHRvIG5ld29zcHJvYy0tPjxnIGlkPSJsaW5rX3B0aHJlYWRfY3JlYXRlX25ld29zcHJvYyI+PHBhdGggZD0iTTQ1NC43MzcsMTU4LjI5NjkgQzQ2NC41NDYsMTU4LjI5NjkgNDc0LjM1NiwxNTguMjk2OSA0ODQuMTY1LDE1OC4yOTY5ICIgZmlsbD0ibm9uZSIgaWQ9InB0aHJlYWRfY3JlYXRlLWJhY2t0by1uZXdvc3Byb2MiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDQ5LjYwNywxNTguMjk2OSw0NTguNjA3LDE2Mi4yOTY5LDQ1NC42MDcsMTU4LjI5NjksNDU4LjYwNywxNTQuMjk2OSw0NDkuNjA3LDE1OC4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLXJldmVyc2UgbGluayBtc3RhcnQgdG8gcHRocmVhZF9jcmVhdGUtLT48ZyBpZD0ibGlua19tc3RhcnRfcHRocmVhZF9jcmVhdGUiPjxwYXRoIGQ9Ik0yODcuMjk1LDE1OC4yOTY5IEMyOTcuMzA2LDE1OC4yOTY5IDMwNy4zMTYsMTU4LjI5NjkgMzE3LjMyNywxNTguMjk2OSAiIGZpbGw9Im5vbmUiIGlkPSJtc3RhcnQtYmFja3RvLXB0aHJlYWRfY3JlYXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI4Mi4wNjEsMTU4LjI5NjksMjkxLjA2MSwxNjIuMjk2OSwyODcuMDYxLDE1OC4yOTY5LDI5MS4wNjEsMTU0LjI5NjksMjgyLjA2MSwxNTguMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1TUkM9W0FxZkRCYWRDSXl6OUxMMGdBaXFob1NuRHJJakZwNHVqSzU5OEI1TzBpeFlBQzlLS2JvR01iVUkycksyT3MxSmJmUFAzYjgwT2sxR09tYktPdWIySU5ybkdiOXlDS21SWDhJaWpBQ2FlSWFyQ1lLeTZhWU1mTzdNZUdqWkNwR0t4NndtT21rSllBaWFpMFFidWxjZFZ5dEtEcHBpeG1sRUJpYkVCNTdvVnhqWm5PZGRCcXV4UEp0VmxVaFFyeVZjQVJZS2tCZDM4QTQyMFJiNWNVYVE5aFhxaUEyMEtjWG11MzQyNFdXOE02S0VtYjI1Q0FZTV9GMHlZMF9La2QwTEphUEVRMWpBQnZiNUtCYm1MbjhTMF0tLT48L2c+PC9zdmc+">
<p>Worker M的启动通常由<code>runtime.wakep()</code>开始，在执行<code>runtime.startm()</code>时，需要获取空闲状态的P和空闲状态的M，如果没有空闲状态的P，则不会继续创建流程，而如果没有空闲状态的M，则会执行<code>runtime.newm()</code>创建新的M。</p>
<p>M结构的内存分配与g0的初始化就在<code>runtime.newm()</code>中进行，函数<code>runtime.newosproc()</code>是Go抽象出来的统一接口，主要用来创建系统线程，通过条件编译的方式，在不同的平台上有不同的实现方式，如：darwin上底层执行的是<code>pthread_create</code>系统接口创建线程，而在windows上执行的是<code>CreateThread</code>系统接口，创建线程的同时，会将已经初始化完成的M结构的指针传递到对应的创建线程的系统接口中，由线程的启动回调负责在新线程中做后续的处理，直到流程执行至<code>runtime.mstart()</code>，新M的执行流程参考<a href="/2022/07/10/notes/golang/advanced/g0/">《Golang深度解读：g0》</a>。</p>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyNzhweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjg1MHB4O2hlaWdodDoyNzhweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA4NTAgMjc4IiB3aWR0aD0iODUwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIwIiB4PSIzNTguMjUiIHk9IjIyLjk5NTEiPueyvueugOeJiOiwg+W6pua1geeoi+WbvjwvdGV4dD48IS0tZW50aXR5IG1zdGFydC0tPjxnIGlkPSJlbGVtX21zdGFydCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzEiIHg9IjciIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTEiIHg9IjE3IiB5PSI2Ny4yOTIiPnJ1bnRpbWUubXN0YXJ0PC90ZXh0PjwvZz48IS0tZW50aXR5IG1zdGFydDAtLT48ZyBpZD0iZWxlbV9tc3RhcnQwIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MCIgeD0iMTczLjUiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAiIHg9IjE4My41IiB5PSI2Ny4yOTIiPnJ1bnRpbWUubXN0YXJ0MDwvdGV4dD48L2c+PCEtLWVudGl0eSBtc3RhcnQxLS0+PGcgaWQ9ImVsZW1fbXN0YXJ0MSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDAiIHg9IjM0OC41IiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIwIiB4PSIzNTguNSIgeT0iNjcuMjkyIj5ydW50aW1lLm1zdGFydDE8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc2NoZWR1bGUtLT48ZyBpZD0iZWxlbV9zY2hlZHVsZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDUiIHg9IjUyNCIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNSIgeD0iNTM0IiB5PSI2Ny4yOTIiPnJ1bnRpbWUuc2NoZWR1bGU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZXhlY3V0ZS0tPjxnIGlkPSJlbGVtX2V4ZWN1dGUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwIiB4PSI3MDQuNSIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMCIgeD0iNzE0LjUiIHk9IjY3LjI5MiI+cnVudGltZS5leGVjdXRlPC90ZXh0PjwvZz48IS0tZW50aXR5IGdvZ28tLT48ZyBpZD0iZWxlbV9nb2dvIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExOCIgeD0iNzE0LjUiIHk9IjE0MC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTgiIHg9IjcyNC41IiB5PSIxNjMuMjkyIj5ydW50aW1lLmdvZ288L3RleHQ+PC9nPjwhLS1lbnRpdHkgbG9naWNhbC0tPjxnIGlkPSJlbGVtX2xvZ2ljYWwiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMyIiB4PSI3MDcuNSIgeT0iMjM2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIiIHg9IjcxNy41IiB5PSIyNTkuMjkyIj7nlKjmiLfku6PnoIHpgLvovpHpg6jliIY8L3RleHQ+PC9nPjwhLS1lbnRpdHkgR29zY2hlZC0tPjxnIGlkPSJlbGVtX0dvc2NoZWQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ0IiB4PSI1MjcuNSIgeT0iMjM2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjQiIHg9IjUzNy41IiB5PSIyNTkuMjkyIj5ydW50aW1lLkdvc2NoZWQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbWNhbGwtLT48ZyBpZD0iZWxlbV9tY2FsbCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjAiIHg9IjUzOC41IiB5PSIxNDAuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMCIgeD0iNTQ4LjUiIHk9IjE2My4yOTIiPnJ1bnRpbWUubWNhbGw8L3RleHQ+PC9nPjwhLS1saW5rIG1zdGFydCB0byBtc3RhcnQwLS0+PGcgaWQ9ImxpbmtfbXN0YXJ0X21zdGFydDAiPjxwYXRoIGQ9Ik0xMzguMjk1LDYyLjI5NjkgQzE0OC4yMSw2Mi4yOTY5IDE1OC4xMjYsNjIuMjk2OSAxNjguMDQxLDYyLjI5NjkgIiBmaWxsPSJub25lIiBpZD0ibXN0YXJ0LXRvLW1zdGFydDAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTczLjIyNiw2Mi4yOTY5LDE2NC4yMjYsNTguMjk2OSwxNjguMjI2LDYyLjI5NjksMTY0LjIyNiw2Ni4yOTY5LDE3My4yMjYsNjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIG1zdGFydDAgdG8gbXN0YXJ0MS0tPjxnIGlkPSJsaW5rX21zdGFydDBfbXN0YXJ0MSI+PHBhdGggZD0iTTMxMy41NjgsNjIuMjk2OSBDMzIzLjQ1OCw2Mi4yOTY5IDMzMy4zNDgsNjIuMjk2OSAzNDMuMjM3LDYyLjI5NjkgIiBmaWxsPSJub25lIiBpZD0ibXN0YXJ0MC10by1tc3RhcnQxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM0OC40MDksNjIuMjk2OSwzMzkuNDA5LDU4LjI5NjksMzQzLjQwOSw2Mi4yOTY5LDMzOS40MDksNjYuMjk2OSwzNDguNDA5LDYyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBtc3RhcnQxIHRvIHNjaGVkdWxlLS0+PGcgaWQ9ImxpbmtfbXN0YXJ0MV9zY2hlZHVsZSI+PHBhdGggZD0iTTQ4OC43MjcsNjIuMjk2OSBDNDk4LjY0NSw2Mi4yOTY5IDUwOC41NjQsNjIuMjk2OSA1MTguNDgyLDYyLjI5NjkgIiBmaWxsPSJub25lIiBpZD0ibXN0YXJ0MS10by1zY2hlZHVsZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MjMuNjY5LDYyLjI5NjksNTE0LjY2OSw1OC4yOTY5LDUxOC42NjksNjIuMjk2OSw1MTQuNjY5LDY2LjI5NjksNTIzLjY2OSw2Mi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgc2NoZWR1bGUgdG8gZXhlY3V0ZS0tPjxnIGlkPSJsaW5rX3NjaGVkdWxlX2V4ZWN1dGUiPjxwYXRoIGQ9Ik02NjkuMTYsNjIuMjk2OSBDNjc5LjA4OCw2Mi4yOTY5IDY4OS4wMTYsNjIuMjk2OSA2OTguOTQ1LDYyLjI5NjkgIiBmaWxsPSJub25lIiBpZD0ic2NoZWR1bGUtdG8tZXhlY3V0ZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3MDQuMTM2LDYyLjI5NjksNjk1LjEzNiw1OC4yOTY5LDY5OS4xMzYsNjIuMjk2OSw2OTUuMTM2LDY2LjI5NjksNzA0LjEzNiw2Mi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZXhlY3V0ZSB0byBnb2dvLS0+PGcgaWQ9ImxpbmtfZXhlY3V0ZV9nb2dvIj48cGF0aCBkPSJNNzc0LjMxNyw4MC41Mzc5IEM3NzQuMTU0LDk1Ljc3NTkgNzczLjkxNywxMTguMTAzOSA3NzMuNzQsMTM0Ljc1NDkgIiBmaWxsPSJub25lIiBpZD0iZXhlY3V0ZS10by1nb2dvIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc3My42ODIsMTQwLjE2NDksNzc3Ljc3NjksMTMxLjIwNzcsNzczLjczNDksMTM1LjE2NTIsNzY5Ljc3NzQsMTMxLjEyMzEsNzczLjY4MiwxNDAuMTY0OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGdvZ28gdG8gbG9naWNhbC0tPjxnIGlkPSJsaW5rX2dvZ29fbG9naWNhbCI+PHBhdGggZD0iTTc3My41LDE3Ni41Mzc5IEM3NzMuNSwxOTEuNzc2IDc3My41LDIxNC4xMDM4IDc3My41LDIzMC43NTQ1ICIgZmlsbD0ibm9uZSIgaWQ9ImdvZ28tdG8tbG9naWNhbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3NzMuNSwyMzYuMTY1Miw3NzcuNSwyMjcuMTY1Miw3NzMuNSwyMzEuMTY1Miw3NjkuNSwyMjcuMTY1Miw3NzMuNSwyMzYuMTY1MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgR29zY2hlZCB0byBsb2dpY2FsLS0+PGcgaWQ9ImxpbmtfR29zY2hlZF9sb2dpY2FsIj48cGF0aCBkPSJNNjc2LjU4NywyNTQuMjk2OSBDNjg2Ljg1NSwyNTQuMjk2OSA2OTcuMTIyLDI1NC4yOTY5IDcwNy4zOSwyNTQuMjk2OSAiIGZpbGw9Im5vbmUiIGlkPSJHb3NjaGVkLWJhY2t0by1sb2dpY2FsIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY3MS41NDcsMjU0LjI5NjksNjgwLjU0NywyNTguMjk2OSw2NzYuNTQ3LDI1NC4yOTY5LDY4MC41NDcsMjUwLjI5NjksNjcxLjU0NywyNTQuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgbWNhbGwgdG8gR29zY2hlZC0tPjxnIGlkPSJsaW5rX21jYWxsX0dvc2NoZWQiPjxwYXRoIGQ9Ik01OTguNzQxLDE4MS45NTkgQzU5OC45MTksMTk4LjYzNjggNTk5LjE1NiwyMjAuOTYxMSA1OTkuMzE4LDIzNi4xNjUyICIgZmlsbD0ibm9uZSIgaWQ9Im1jYWxsLWJhY2t0by1Hb3NjaGVkIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU5OC42ODMsMTc2LjUzNzksNTk0Ljc3OTEsMTg1LjU4LDU5OC43MzYzLDE4MS41Mzc2LDYwMi43Nzg3LDE4NS40OTQ3LDU5OC42ODMsMTc2LjUzNzkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIHNjaGVkdWxlIHRvIG1jYWxsLS0+PGcgaWQ9Imxpbmtfc2NoZWR1bGVfbWNhbGwiPjxwYXRoIGQ9Ik01OTYuOTgyLDg1Ljk1ODkgQzU5Ny4zMzcsMTAyLjYzNjkgNTk3LjgxMiwxMjQuOTYwOSA1OTguMTM1LDE0MC4xNjQ5ICIgZmlsbD0ibm9uZSIgaWQ9InNjaGVkdWxlLWJhY2t0by1tY2FsbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1OTYuODY3LDgwLjUzNzksNTkzLjA1ODIsODkuNjIwNCw1OTYuOTcyNyw4NS41MzY4LDYwMS4wNTY0LDg5LjQ1MTMsNTk2Ljg2Nyw4MC41Mzc5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLVNSQz1bVFAzMVlpOG00OFJsVU9oR2tzOVZtRWktSHdkUGoxMlI5S3RQRklnMkwzbTl0bFFvaTIwem9SQW0yMGZ6NmNscUJSUVRKQUgycDI3cFhfLVJJVjhoNWtpZXV1QkhHMU1QSmdUaUVDcnJmN0gwZXZuUUlUR3BRRElaSGktbmk4VTVGWW9GNHBPZjEwRkU3Tm1XLXMxbmVJczdzZVRub0lLbWRVVzNQYmpUb2lGdno2cy12aFZQd0xmbFJla2dBUFMwMnlkSkUxQS1XSXlJTldLT1FrenRzdFBYRnppZkdkSWd1VGhWc2tuZFBiTFVWblJEU05WdmN2amd0TnBNMEk0czVHZmhlNUFVd0M3dWRZWE1kbmNZNkp3UXpfMlNVNzFUUDVYandxSS1Qd3E3S05LUm5VS0M1bWpNd21kc3NXcnFNTTJyTmw3TUVYR1pXRHJESENVenhIeTBdLS0+PC9nPjwvc3ZnPg==">
<h3 id="m0"><a href="#m0" class="headerlink" title="m0"></a>m0</h3><p>Worker M通常是由其他M通过结构初始化并访问系统调用，执行线程创建接口创建出来，最后经过<code>runtime.mstart()</code>进入正常Worker M的计算逻辑，那第一个M是怎么来的呢？</p>
<p>在Go语言runtime包中，通过不同版本的汇编实现了不同平台上程序启动的<code>main()</code>函数入口，然后执行<code>runtime.rt0_go()</code>完成对Go程序的初始化，并使用全局定义的m0/g0初始化第一个M，并将<code>runtime.main()</code>函数地址传入<code>runtime.newproc()</code>创建第一个用户协程，再执行<code>runtime.mstart()</code>进行正常后续流程。</p>
<p>接下来的流程就比较熟悉了，m0进入调度循环，并启动第一个用户协程<code>runtime.main()</code>进行前期的初始化，再访问用户代码中的<code>main.main()</code>正式执行用户代码逻辑。</p>
<p><strong>注：m0也是正常的Worker M，只不过创建的流程不太一样</strong></p>
<h2 id="sysmon"><a href="#sysmon" class="headerlink" title="sysmon"></a>sysmon</h2><p>Go语言中除了负责执行用户协程的的一组Worker M之外，还有一个独立的监控M，称之为sysmon。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemstack(<span class="name">func</span>() &#123;</span><br><span class="line">    newm(<span class="name">sysmon</span>, <span class="literal">nil</span>, <span class="number">-1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>sysmon在m0初始化完，执行第一个协程<code>runtime.main()</code>时，在<code>runtime.main()</code>函数中被创建，因为sysmon不直接服务于用户协程，因此没有绑定可执行的P，没有绑定P的M，所有的执行流程都在g0中。sysmon主要负责完成Go程序在执行期间的一些协同工作，如：处理系统调用阻塞(syscall)、用户协程执行时间过长(关于Go程序的抢占调度方案后面再细致的剖析)，还有超时未poll network等等问题。</p>
<h2 id="template-thread"><a href="#template-thread" class="headerlink" title="template thread"></a>template thread</h2><p>在<code>runtime.newm()</code>的函数中，创建新的线程时，由于Linux之类的系统底层是通过类似fork的系统调用创建线程，当M处于locked状态或M是在CGO中创建，在fork时可能会复制很多不可预知的状态，于是使用到了template thread的处理机制，在不方便由当前M直接创建新M时，将创建任务传递到template thread中，让template thread负责创建新的M，并按正常流程启动。</p>
<p>template thread由<code>runtime.startTemplateThread()</code>创建，在m0初始化完，执行<code>runtime.main()</code>时，在CGO的检查项中执行<code>runtime.startTemplateThread()</code>创建template thread，另一处是<code>runtime.LockOSThread()</code>中，并且template thread也是不绑定P的。</p>
</div><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://oldchan.net/2022/07/24/notes/golang/advanced/m/" data-id="clcvkyfdb002o96u3ksi2oh1d" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACI0lEQVR42u3aQW6DQAwF0Nz/0um2iwLfNqkU81hVLTDzqGR5bL9e8fX+dZ3/Jv9r8tTNFwYGxtcy3qdXcs/5U0dvqH6OozdgYGA8h3EUwfIQmSx/tGKy1sWeMTAwMA4WnofO6roYGBgYNwfBVnjFwMDAmBxie8W4ZKO9wzMGBsZzGHnV/f9//kh/AwMD46sYvXJ/9YDaC9yFXWFgYKxm5AHuHJMPTEwOwxf7wcDAWMqYF9HOYb2k8Dy4v+79NhgYGF/CmCxWDY69j3LRYMDAwHgAY9KwvDdZ7KWJGBgYuxnngSwBzMtqyUBGBMPAwHgAo9cSqI5WVDdaGK3AwMBYzfifIDsvtEVBGQMDYzUjCb45u5cC5qtcrI6BgbGOkQfTalhMksh5AoqBgbGbUQ2anxhj7Q1bYGBgPIdR7Qn2BimqyGqPEgMD4zmMSZk+2WL12eYQBgYGxjpGb1SrmjgmpNGwBQYGxmrG5EiZh8h8BDYf17j4n2BgYCxl5BvKU8BJCyEJ/RctTAwMjHWMXtNxnvY1B7/y1BADA2M1I08Ze2liYYvJGzAwMJYy3sVrXuOqHmWj0IyBgbGaUQ1zeQGuWrz7eOKIgYHx5Yz8gDov3987ahbVAjEwMBYxegfO/J78M/V2i4GBgVEdwsgbkHe9DQMDA2MeEPNRjORY+8edGBgYD2DkgxR56X8yalYu3mFgYKxm9MLopLmYf4K88YCBgbGU8QN4QXRytAmo9AAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/golang/"><i class="fa fa-tag"></i>golang</a></div><div class="post-nav"><a class="pre" href="/2022/08/15/notes/golang/advanced/p/">Golang深度解读：P</a><a class="next" href="/2022/07/10/notes/golang/advanced/g0/">Golang深度解读：g0</a></div><div id="tcomment"></div><script src="https://fastly.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({
  envId: 'thecxx-1gxw7szk895715fd',
  el: '#tcomment',
  region: 'ap-shanghai',
  path: ''
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/容器/">容器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/笔记/">笔记</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统/">系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/长话/">长话</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/容器化/" style="font-size: 15px;">容器化</a> <a href="/tags/思考/" style="font-size: 15px;">思考</a> <a href="/tags/元宇宙/" style="font-size: 15px;">元宇宙</a> <a href="/tags/cpu/" style="font-size: 15px;">cpu</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/中间件/" style="font-size: 15px;">中间件</a> <a href="/tags/go/" style="font-size: 15px;">go</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/注入/" style="font-size: 15px;">注入</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/12/10/notes/golang/advanced/schedule/">Golang深度解读：调度</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/15/notes/golang/advanced/p/">Golang深度解读：P</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/24/notes/golang/advanced/m/">Golang深度解读：M</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/10/notes/golang/advanced/g0/">Golang深度解读：g0</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/10/notes/golang/advanced/list/">Golang深度解读</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/06/15/opinion/give_up_the_php/">6年前，决定不再继续精进PHP</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/05/05/opinion/good_product/">好的产品?</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/11/17/opinion/internet_and_metaverse/">互联网络与元宇宙</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/18/arch/microservice/service/">微服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/06/arch/middleware/configuration/">配置服务迁移</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">KAMI.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//fastly.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//fastly.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/prettify.js?v=1.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/codeblock-render.js?v=1.0.0"></script></div></body></html>